<div class="card container p-3" id="profile-card">
  <!-- Row 1: Display Name -->
  <div class="row">
    <h5>
      <span class="material-symbols-outlined align-bottom px-2">person</span>
      <span id="display-name"><%= displayName %></span>
    </h5>
  </div>
  <!-- Row 2: Change Display Name -->
  <div class="row">
    <form
      method="post"
      action=""
      class="form mb-4"
      id="display-name-form"
      data-user-id="<%= userId %>"
    >
      <input type="text" id="display-name-input" />
      <!-- Submission of form -->
      <button
        type="submit"
        class="btn btn-outline-light btn-sm px-2"
        id="change-display-name-button"
      >
        Change Display Name
      </button>
    </form>
  </div>
  <!-- Row 2: Achieved Badges -->
  <div class="row py-2" id="badge-display">
    <div class="col my-auto">
      <h5>Achieved Achievements</h5>
      <span class="material-symbols-outlined align-bottom px-2"> elderly </span>
      <span class="material-symbols-outlined align-bottom px-2"> rocket_launch </span>
      <span class="material-symbols-outlined align-bottom px-2"> school </span>
    </div>
  </div>
  <!-- Row 3: Achievements -->
  <div class="row py-2 mt-3" id="badge-display">
    <div class="col my-auto"><%- include('achievementList.ejs'); %></div>
  </div>

  <script>
    const userId = '<%= userId %>';
    const urlPrefix = '<%= urlPrefix %>';

    // Function to update the display name
    function updateDisplayName(event) {
      event.preventDefault(); // prevent form from submitting normally
      const newDisplayName = document.querySelector('#display-name-input').value;

      // Create FormData to append CSRF token
      let formData = new FormData();
      let csrfToken = '<%= __csrf_token %>';
      console.log('CSRF Token:', csrfToken);
      formData.append('__csrf_token', csrfToken);

      fetch(urlPrefix + '/plrStudent/' + userId + '/' + encodeURIComponent(newDisplayName), {
        method: 'POST',
        body: formData,
      })
        .then((response) => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json(); // This returns a promise
        })
        .then((jsonResponse) => {
          // Update the display name in the page
          document.querySelector('#display-name').textContent = newDisplayName;
        })
        .catch((error) => {
          console.error('Error updating display name:', error);
          console.error('Error name:', error.name);
          console.error('Error stack:', error.stack);
        });
    }

    // Add a click event listener to the "Change Display Name" button
    document
      .querySelector('#change-display-name-button')
      .addEventListener('click', updateDisplayName);
  </script>
</div>
